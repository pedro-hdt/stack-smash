#!/bin/bash

echo "--------------------------------------------------------------------------------"
echo "*     Building source                                                          *"
echo "--------------------------------------------------------------------------------"
make
echo

echo "--------------------------------------------------------------------------------"
echo "*     Building payload                                                         *"
echo "--------------------------------------------------------------------------------"
python3 build_exploit.py
echo

echo "--------------------------------------------------------------------------------"
echo "*     Running exploit                                                          *"
echo "--------------------------------------------------------------------------------"
eval aslr=$(cat /proc/sys/kernel/randomize_va_space)
if [ $aslr != "0" ] ; then
    echo "ASLR is enabled. Please disable it by running:"
    echo "\$ echo 0 | sudo tee /proc/sys/kernel/randomize_va_space"
    echo "then try again."
    echo "Aborting exploit"
    echo
    exit 1
fi
echo -ne 'run\n-1' | gdb rop
